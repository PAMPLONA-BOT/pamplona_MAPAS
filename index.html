<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Aplicación de Navegación</title>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f4f4f4;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      height: 100vh;
      flex-direction: column;
      color: #333;
    }

    .container {
      width: 90%;
      max-width: 600px;
      background-color: #fff;
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
      padding: 20px;
      border-radius: 12px;
      text-align: center;
      margin: 0 auto 60px auto;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .container:hover {
      transform: scale(1.02);
      box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
    }

    .btn {
      background-color: #4CAF50;
      color: white;
      padding: 12px 24px;
      margin: 10px 0;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      width: 100%;
      transition: background-color 0.3s ease, transform 0.3s ease;
    }

    .btn:hover {
      background-color: #45a049;
      transform: translateY(-3px);
    }

    .btn-regresar {
      background-color: #FF6347;
      width: 50%;
      margin: 10px auto;
    }

    .btn-regresar:hover {
      background-color: #FF4500;
      transform: translateY(-3px);
    }

    h1 {
      margin-bottom: 20px;
      font-size: 28px;
      font-weight: bold;
      color: #333;
    }

    .logo {
      width: 120px;
      height: auto;
      margin-bottom: 20px;
    }

    .hidden {
      display: none;
    }

    label {
      font-weight: bold;
      color: #444;
      margin-bottom: 6px;
      text-align: left;
      display: block;
    }

    .form-group {
      margin-bottom: 20px;
      text-align: left;
      width: 100%;
    }

    .form-group select,
    .form-group input[type="text"] {
      width: 100%;
      padding: 10px;
      margin-top: 4px;
      border: 2px solid #ccc;
      border-radius: 6px;
      font-size: 16px;
      box-sizing: border-box;
    }

    #cicloSeccion {
      display: flex;
      justify-content: space-between;
      gap: 20px;
    }

    #cicloSeccion .form-group {
      flex: 1;
    }

    .btn-row {
      display: flex;
      justify-content: space-between;
      gap: 5px;
      margin-bottom: 20px;
    }

    .btn-row .btn {
      width: 48%;
    }

    #vistaReporte h2 {
      font-size: 30px;
      font-weight: bold;
      margin-bottom: 20px;
      color: #2E8B57;
      text-align: center;
    }

    .footer {
      position: fixed;
      bottom: 0;
      width: 100%;
      text-align: center;
      font-size: 14px;
      color: #888;
      background-color: #fff;
      padding: 10px 0;
      box-shadow: 0 -4px 10px rgba(0, 0, 0, 0.1);
    }

    .footer p {
      margin: 0;
    }

    #whatsappLink {
      text-decoration: none;
      text-align: center;
    }
  </style>
</head>
<body>

<!-- Vista principal -->
<div class="container" id="inicio">
  <img src="Logo.png" alt="Logo de la página" class="logo">
  <h1>REGIONAL PAMPLONA</h1>

  <button class="btn" onclick="mostrarFormulario()">REPORTE DIARIO</button>
  <button class="btn" onclick="irAUrl('https://script.google.com/macros/s/AKfycbwEzt9hEVWLy-7GaGEdp1R8SW76SrjOkLOANzhdzaSVq1JszaJ_MyNKhlEHRD7lrbp2sA/exec', 'validarUsuario')">VALIDADOR USUARIO</button>
  <button class="btn" onclick="irAUrl('https://script.google.com/macros/s/AKfycbw2z6rVlBqlPU0drL9Rus_p_ORjVfl8iGQBL-gupoDio4Fq3ElbrqUILguiAtLYWpJZfg/exec', 'revisionEjecutada')">REVISIONES EJECUTADAS</button>
  <button class="btn" onclick="irAUrl('https://script.google.com/macros/s/AKfycbw-YQTef8VFk4KPc7S8iPnmMXxzaXLegyH8tLk-TqxNwROMi-mRqiUh8LwhQ2J1RbXFAA/exec', 'pendienteDescargas')">CONSULTA DE RUTA Y KML</button>
  <button class="btn" onclick="irAUrl('https://www.google.com', 'paginaPrueba')">ERRORES</button>
</div>

<!-- Vista de formulario -->
<div class="container hidden" id="vistaReporte">
  <h2>Reporte Diario</h2>

  <div class="form-group">
    <label for="operario">Operario:</label>
    <select id="operario"></select>
  </div>

  <div id="cicloSeccion">
    <div class="form-group">
      <label for="ciclo">Ciclo:</label>
      <select id="ciclo"></select>
    </div>
    <div class="form-group">
      <label for="seccion">Sección:</label>
      <select id="seccion"></select>
    </div>
  </div>

  <div class="form-group">
    <label for="via">Reporte de Vía traslado,primer usuario o fin de labores:</label>
    <input type="text" id="via" placeholder="Ingrese dato segun reporte, la vía de traslado, primer usuario o lugar de finalizacion">
  </div>

  <div class="btn-row">
    <button class="btn" onclick="enviarReporte('salida')">TRASLADO SALIDA</button>
    <button class="btn" onclick="enviarReporte('regreso')">TRASLADO REGRESO</button>
  </div>

  <div class="btn-row">
    <button class="btn" onclick="enviarReporte('inicio')">INICIO DE LABOR</button>
    <button class="btn" onclick="enviarReporte('fin')">FIN DE LABOR</button>
  </div>

  <button class="btn btn-regresar" onclick="regresarAPrincipal()">INICIO</button>
  <a id="whatsappLink" href="#" target="_blank" class="btn hidden">ENVIAR AL GRUPO DE WHATSAPP</a>
</div>

<div class="footer">
  <p>Versión: 001</p>
  <p id="fechaHora"></p>
</div>

<script>
  // Datos internos en vez de fetch desde Google Sheets
  const data = {
    operarios: ["ANTELIZ BRAND RICARDO SEBASTIAN", "ARIAS MENESES HEYSON FERNEY", "BOHORQUEZ GONZALEZ DANILO","CALDERON MONCADA JUAN CARLOS","CONTRERAS CALDERON SAID ALEXADER ","CAMPEROS VARGAS JHON ALEXANDER","DAVILA VARGAS HOBER ALEJANDRO","ELKIN LEONARDO PEÑA","GARCIA VERA LEDYD YESID","PABON MOLINA ZAYED CAMILO","PEÑA DELGADO BORIS AMIN","PEÑALOZA GONZALEZ ELVER DAVID","VERA GARCIA CARLOS JAVIER","CONTRERAS SALCEDO BRALLAM ARLEY","MORENO ANGARITA NESTOR JULIAN","BOHORQUEZ GONZALEZ ALLEX DANTEE"],
    ciclos: ["240", "241", "250", "225", "271", "272", "275", "276", "277", "278", "279", "290", "292", "293", "295"],
    seccionesPorCiclo: {

      "271": ["47", "48", "54", "55", "56", "57"],
      "240": ["500", "501", "502", "503", "504", "505", "506", "507", "508", "509", "510", "511", "512", "513", "514", "515", "516", "517", "518", "519", "520", "521", "522", "523", "524", "525", "526", "527", "528", "529", "530", "531", "532", "533", "534", "535", "536", "537", "538", "539", "540", "541", "542", "543", "544", "545", "546", "547", "548", "549", "550", "551", "552", "553", "554", "555", "556", "557", "558", "559", "560", "561", "562", "563", "564", "565", "566", "567", "568", "569", "570", "571", "572", "573", "574", "575", "576", "577", "578", "579", "580", "581", "582", "583", "584", "585", "586", "587", "588", "600", "601", "602", "603", "604", "605", "606", "607", "608", "609", "610", "611", "612", "613", "614", "615", "616", "617", "618", "619", "620", "621", "622", "623", "624", "625", "626", "627", "628", "629", "630", "631", "632", "633", "634", "635", "636", "637", "638", "639", "640", "641", "642", "643", "644", "645", "646", "700", "701", "702", "703", "704", "705", "706", "707", "708", "709", "710", "711", "712", "713", "751", "752", "753", "754", "756", "757", "758", "759", "760", "761", "762", "763", "764", "765", "766", "767", "768", "769", "770", "771", "772", "773", "774", "775", "776", "777", "778", "779", "780", "781", "782", "801", "802", "803", "804", "805", "806", "807", "808", "809", "811", "812", "813", "814", "815", "816", "818", "819", "820", "821", "822", "823", "824", "825", "826", "828", "829", "851", "852", "853", "854", "855", "856", "857", "858", "859", "860", "861", "862", "863", "864", "866", "868", "869", "870", "871", "872", "873", "874", "875", "877", "878", "879", "880", "882", "883", "885", "886", "887", "888", "889", "890", "892", "893", "894", "895", "896", "897", "898", "899", "900", "901", "902", "951", "952", "953", "954", "955"],
      "241": ["300", "301", "302", "303", "305", "306", "307", "308", "310", "311", "312", "313", "314", "315", "316", "317", "318", "319", "320", "321", "322", "323", "325", "327", "328", "329", "330", "331", "332", "333", "334", "335", "336", "337", "338", "339", "340", "341", "342", "343", "344", "345", "346", "347", "348", "349", "350", "351", "353", "355", "356", "360", "361", "362", "401", "405", "410", "411", "417", "418", "419", "427", "441", "450", "451", "452", "453", "454", "455", "456", "457", "470", "471", "472", "473", "475", "497", "498", "499", "500", "501", "502", "503", "504", "505", "506", "507", "508", "509", "510", "511", "512", "513", "514", "515", "516", "517", "518", "519", "520", "521", "522", "523", "524", "525", "526", "527", "528", "529", "530", "531", "532", "533", "534", "535", "536", "537", "538", "539", "540", "541", "542", "543", "544", "545", "546", "547", "548", "549", "550", "551", "552", "553", "554", "555", "556", "557", "558", "559", "560", "561", "562", "563", "564", "565", "566", "567", "568", "569", "570", "571", "572", "573", "574", "575", "576", "577", "578", "579", "583", "586", "587", "588", "589", "590", "591", "592", "593", "594", "595", "596", "597", "598", "599", "600", "601", "602", "603", "604", "605", "606", "607", "608", "609", "610", "611", "612", "613", "614", "615", "616", "617", "618", "619", "620", "621", "622", "623", "624", "625", "626", "627", "628", "629", "630", "631", "632", "633", "634", "635", "636", "637", "638", "639", "640"],
      "250": ["499", "524", "525", "526", "541", "577", "578", "581", "582", "584", "585", "586", "595", "599", "601", "602", "624", "626", "627", "678", "683", "684"],
      "225": ["100"],
      "272": ["49", "50", "65", "66", "67", "68"],
      "275": ["5", "6", "10", "11", "12", "14", "15", "72", "73", "77", "78", "79"],
      "276": ["1", "2", "3", "4", "13", "74", "75", "76"],
      "277": ["18", "19", "30", "31", "32", "34", "35", "36"],
      "278": ["16", "17", "20", "21", "22", "23", "24", "33"],
      "279": ["415", "416", "418", "419", "420", "421", "422", "423", "425", "426", "427", "517", "518", "519", "522", "525", "526", "527", "528"],
      "290": ["7", "8", "9", "10", "11", "12", "13", "41", "43", "45", "46"],
      "292": ["38", "39", "40", "41", "42"],
      "293": ["51", "52", "53", "59", "62", "63", "64", "69", "71", "80", "81", "82", "83", "84", "85", "86", "87", "88", "89", "90"],
      "295": ["20", "21", "22", "23", "24", "25", "26", "27", "28", "37", "38"]
    }
  };

  // Usamos los datos embebidos directamente
  window.onload = function () {
    mostrarFechaHora();

    // Llenar selects al cargar
    llenarSelect("operario", data.operarios);
    llenarSelect("ciclo", data.ciclos);

    document.getElementById("ciclo").addEventListener("change", function () {
      const cicloSeleccionado = this.value;
      const secciones = data.seccionesPorCiclo[cicloSeleccionado] || [];
      llenarSelect("seccion", secciones);
    });
  };

  function llenarSelect(id, valores) {
    const select = document.getElementById(id);
    select.innerHTML = '<option value="">Seleccione</option>';
    valores.forEach(valor => {
      const option = document.createElement("option");
      option.value = valor;
      option.textContent = valor;
      select.appendChild(option);
    });
  }

  function irAUrl(url, boton) {
    if (boton === 'validarUsuario') {
      window.open(url, '_blank');
    } else {
      localStorage.setItem('lastVisited', url);
      window.location.href = url;
    }
  }

  function mostrarFechaHora() {
    const now = new Date();
    const fecha = now.toLocaleDateString();
    const hora = now.toLocaleTimeString();
    document.getElementById('fechaHora').innerHTML = `Fecha y Hora: ${fecha} ${hora}`;
  }

  function mostrarFormulario() {
    document.getElementById('inicio').classList.add('hidden');
    document.getElementById('vistaReporte').classList.remove('hidden');
  }

  function regresarAPrincipal() {
    document.getElementById('vistaReporte').classList.add('hidden');
    document.getElementById('inicio').classList.remove('hidden');
  }

  
  const formUrl = 'https://script.google.com/macros/s/AKfycbxhL9z2Ja7I0QFHn3nReY2NVR1AIn1_SJtei9FIifBLI7vy8PWz0cv_6Dr1Y61z9blcJA/exec';

  function enviarReporte(tipo) {
    const operario = document.getElementById('operario').value;
    const ciclo = document.getElementById('ciclo').value;
    const seccion = document.getElementById('seccion').value;
    const via = document.getElementById('via').value;

    const fechaActual = new Date();
    const fecha = fechaActual.toLocaleDateString();
    const hora = fechaActual.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

    // Validación
    if ((tipo === 'salida' || tipo === 'regreso') && (!operario || !ciclo || !seccion || !via)) {
      alert("Por favor complete todos los campos.");
      return;
    }

    if ((tipo === 'inicio' || tipo === 'fin') && (!operario || !via)) {
      alert("Por favor complete los campos de Operario y Vía.");
      return;
    }

    // Crear mensaje
    let encabezado = "";
    if (tipo === 'salida') encabezado = "🚗 *TRASLADO DE SALIDA*";
    else if (tipo === 'regreso') encabezado = "🚙 *TRASLADO DE REGRESO*";
    else if (tipo === 'inicio') encabezado = "🟢 *REPORTE PRIMERA LECTURA*";
    else if (tipo === 'fin') encabezado = "🔴 *FIN DE LABORES*";

    let mensaje = `${encabezado}\n📅 Fecha: ${fecha}\n🕒 Hora: ${hora}\n👷‍♂️ Operario: ${operario}`;
    if (tipo === 'salida' || tipo === 'regreso') {
      mensaje += `\n📦 Ciclo: ${ciclo}\n📍 Sección: ${seccion}\n📌 Vía: ${via}`;
    } else {
      mensaje += `\n📌 ${tipo === 'inicio' ? 'Usuario' : 'Destino'}: ${via}`;
    }

    // Obtener ubicación GPS
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(function (position) {
        const lat = position.coords.latitude.toFixed(6);
        const lon = position.coords.longitude.toFixed(6);
        const ubicacion = `https://www.google.com/maps?q=${lat},${lon}`;

        mensaje += `\n📍 Ubicación: ${ubicacion}`;

        // Enviar a WhatsApp
        const mensajeCodificado = encodeURIComponent(mensaje);
        const link = `https://wa.me/?text=${mensajeCodificado}`;

        // Verificar si la ventana emergente fue bloqueada
        const ventana = window.open(link, "_blank");
        if (!ventana) {
          alert("No se pudo abrir WhatsApp. Por favor, habilita las ventanas emergentes.");
        }

        // Enviar a Google Sheets
        fetch(formUrl, {
          method: 'POST',
          body: JSON.stringify({
            fecha,
            hora,
            operario,
            ciclo,
            seccion,
            via,
            tipo,
            ubicacion
          }),
          headers: {
            'Content-Type': 'application/json'
          }
        }).then(response => {
          if (response.ok) {
            alert("Reporte enviado exitosamente!");
          } else {
            throw new Error("Error al enviar los datos.");
          }
        }).catch(error => {
          alert("Hubo un problema al enviar los datos. Intenta nuevamente.");
          console.error(error);
        });

      }, function () {
        alert("No se pudo obtener la ubicación.");
      });
    } else {
      alert("Este navegador no admite geolocalización.");
    }
  }
</script>


</body>
</html>
